import "~/styles/globals.css"
import { Toaster } from "~/components/ui/toaster"
import { Nav } from "~/components/nav"
import { ArticlePageLayout } from "~/components/articles/article-page-layout"
import { AuthProvider } from "~/modules/auth/auth.provider"
import { Source_Sans_Pro } from "next/font/google"
import { getServerSession } from "next-auth"
import { authOptions } from "~/modules/auth/auth.options"
import { PopularTags } from "~/components/tags/popular-tags"

const sourceSansPro = Source_Sans_Pro({
    weight: ["400", "600", "700"],
    subsets: ["latin"],
    fallback: ["sans-serif"],
})

export const metadata = {
    title: "Create Next App",
    description: "Generated by create next app",
}

export default async function RootLayout({
    children,
}: {
    children: React.ReactNode
}) {
    const session = await getServerSession(authOptions)

    return (
        <html lang="en">
            <body className={sourceSansPro.className}>
                <AuthProvider>
                    <Nav session={session} />
                    <main className="flex gap-8">
                        <ArticlePageLayout session={session}>
                            {children}
                        </ArticlePageLayout>
                        {/* @ts-expect-error Async server component */}
                        <PopularTags />
                    </main>
                    <Toaster />
                </AuthProvider>
            </body>
        </html>
    )
}
